<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrier Helper</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <h1>Carrier Helper</h1>
    <p class="subtitle">Track your mail carrier shifts with ease</p>

    <nav class="view-nav">
      <button id="nav-time-entries" class="nav-btn active">Time Entries</button>
      <button id="nav-data-viewer"  class="nav-btn">Data Viewer</button>
    </nav>

    <div class="cloud-sync-bar">
      <button
        id="cloudSyncLoginBtn"
        class="btn-cloud-sync"
        style="display: none"
        onclick="CloudSyncModule.openAuthModal()"
      >‚òÅÔ∏è Sign In to Sync</button>
      <div id="cloudSyncUserStatus" class="cloud-user-status" style="display: none">
        <span id="cloudSyncUserEmail" class="user-email"></span>
        <span id="syncStatusIndicator" class="sync-status" style="display: none"></span>
        <button onclick="CloudSyncModule.signOut()" class="btn-cloud-signout">Sign Out</button>
      </div>
      <div id="syncErrorDetail" class="sync-error-detail" style="display: none"></div>
    </div>
  </header>

  <!-- Cloud Sync Login Modal -->
  <div id="cloudSyncModal" class="modal" style="display: none">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚òÅÔ∏è Cloud Sync</h3>
        <button onclick="CloudSyncModule.closeAuthModal()" class="modal-close" title="Close">‚úï</button>
      </div>
      <p class="modal-description">
        Sign in to sync your time entries across all your browsers and devices automatically.
      </p>
      <div class="form-group">
        <label for="authEmail">Email:</label>
        <input type="email" id="authEmail" class="auth-input" placeholder="you@example.com" />
      </div>
      <div class="form-group">
        <label for="authPassword">Password:</label>
        <input type="password" id="authPassword" class="auth-input" placeholder="Password" />
      </div>
      <div id="authError" class="auth-error" style="display: none"></div>
      <div class="auth-actions">
        <button id="authSignInBtn" onclick="CloudSyncModule.handleSignIn()" class="btn-primary">Sign In</button>
        <button id="authSignUpBtn" onclick="CloudSyncModule.handleSignUp()" class="btn-secondary">Create Account</button>
      </div>
      <p class="auth-note">
        Your data is stored privately in the cloud and only accessible with your account.
      </p>
    </div>
  </div>

  <main>
    <!-- Time Entries View -->
    <div id="time-entries-view">
      <section class="clock-panel">
        <div class="status-display">
          <span id="status-label">Status:</span>
          <span id="status-value" class="status-out">Clocked Out</span>
        </div>
        <div class="current-time" id="current-time">--:--:--</div>
        <button id="clock-btn" class="btn btn-in">Clock In</button>
      </section>

      <!-- Current shift (in-progress) or Last Shift (most recent completed) -->
      <section class="entries-panel" id="current-shift-panel">
        <div class="entries-header">
          <h2 id="current-shift-title">Current Shift</h2>
          <button class="btn-collapse" id="current-shift-toggle" aria-expanded="true" title="Collapse section">‚ñº</button>
        </div>
        <div class="panel-body" id="current-shift-body-wrapper">
          <div class="table-wrapper">
            <table id="current-shift-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Clock In</th>
                  <th>Clock Out</th>
                  <th>Duration</th>
                  <th>Notes</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="current-shift-body">
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Recent completed shifts -->
      <section class="entries-panel" id="previous-shifts-panel">
        <div class="entries-header">
          <h2>Previous Shifts</h2>
          <div class="entries-header-actions">
            <button class="btn-collapse" id="previous-shifts-toggle" aria-expanded="true" title="Collapse section">‚ñº</button>
          </div>
        </div>
        <div class="panel-body" id="previous-shifts-body-wrapper">
          <div class="table-wrapper">
            <table id="previous-shifts-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Date</th>
                  <th>Clock In</th>
                  <th>Clock Out</th>
                  <th>Duration</th>
                  <th>Notes</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="entries-body">
              </tbody>
            </table>
            <p id="empty-msg" class="empty-msg">No recent shifts to show.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Data Viewer View -->
    <div id="data-viewer-view" style="display: none">
      <section class="entries-panel">
        <div class="entries-header">
          <h2>All Time Entries</h2>
          <button id="dv-select-all-btn" class="btn-select-all">‚òë Select All</button>
        </div>

        <!-- View mode toggle -->
        <div class="dv-view-mode-row">
          <button id="dv-mode-week" class="btn-mode-toggle active">üìÖ Week View</button>
          <button id="dv-mode-range" class="btn-mode-toggle">üìÜ Custom Range</button>
        </div>

        <!-- Week navigation (shown in week mode) -->
        <div class="dv-week-nav" id="dv-week-nav-row">
          <button id="dv-prev-week" class="btn-nav-week">‚Äπ Prev Week</button>
          <div class="dv-week-center">
            <span id="dv-week-label" class="dv-week-label"></span>
            <div class="dv-jump-to-date">
              <input type="date" id="dv-date-jump" title="Jump to date" />
              <button id="dv-date-jump-btn" class="btn-jump">Go</button>
            </div>
          </div>
          <button id="dv-next-week" class="btn-nav-week">Next Week ‚Ä∫</button>
        </div>

        <!-- Custom range row (shown in custom range mode) -->
        <div class="dv-custom-range-row" id="dv-custom-range-row" style="display:none">
          <div class="dv-range-inputs">
            <label>From: <input type="date" id="dv-range-start" /></label>
            <span class="dv-range-sep">‚Äì</span>
            <label>To: <input type="date" id="dv-range-end" /></label>
            <button id="dv-range-apply-btn" class="btn-jump">Apply</button>
          </div>
          <span id="dv-range-label" class="dv-week-label"></span>
        </div>

        <div class="table-wrapper">
          <table id="dv-table">
            <thead>
              <tr>
                <th class="dv-check-col"></th>
                <th>#</th>
                <th>Date</th>
                <th>Clock In</th>
                <th>Clock Out</th>
                <th>Duration</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="dv-body">
              <!-- Rows injected by app.js -->
            </tbody>
          </table>
          <p id="dv-empty-msg" class="empty-msg">No entries yet.</p>
        </div>
      </section>

      <section class="entries-panel" id="data-mgmt-panel">
        <div class="entries-header">
          <h2>Data Management</h2>
          <button class="btn-collapse collapsed" id="data-mgmt-toggle" aria-expanded="false" title="Collapse section">‚ñº</button>
        </div>
        <div class="panel-body collapsed" id="data-mgmt-body">
          <div class="data-mgmt-sections">
            <div class="data-mgmt-section">
              <h3>Export Data</h3>
              <div class="export-buttons">
                <button id="export-btn" class="btn btn-export">üì• Export All to CSV</button>
                <button id="export-range-btn" class="btn btn-export-range">üìÖ Export Date Range to CSV</button>
              </div>
              <div class="export-range-form" id="export-range-form" style="display:none">
                <div class="export-range-inputs">
                  <label>From: <input type="date" id="export-range-start" /></label>
                  <span class="dv-range-sep">‚Äì</span>
                  <label>To: <input type="date" id="export-range-end" /></label>
                </div>
                <div class="export-range-actions">
                  <button id="export-range-confirm-btn" class="btn-jump">üì• Export</button>
                  <button id="export-range-cancel-btn" class="btn-secondary-sm">Cancel</button>
                </div>
              </div>
              <p class="mgmt-note">Download time entries as a CSV file.</p>
            </div>

            <div class="data-mgmt-section">
              <h3>Import Data</h3>
              <div class="import-buttons">
                <button id="import-add-btn" class="btn btn-import-add">
                  <span class="btn-icon">‚ûï</span>
                  <span class="btn-text">
                    <strong>Add to Existing</strong>
                    <small>Merge with current data</small>
                  </span>
                </button>
                <button id="import-replace-btn" class="btn btn-import-replace">
                  <span class="btn-icon">üîÑ</span>
                  <span class="btn-text">
                    <strong>Replace All</strong>
                    <small>Delete &amp; replace all data</small>
                  </span>
                </button>
              </div>
              <p class="mgmt-note">
                <strong>Add to Existing:</strong> Merges the CSV with your current entries (duplicates skipped).<br>
                <strong>Replace All:</strong> ‚ö†Ô∏è Permanently deletes all current data and replaces it with the CSV file.
              </p>
              <!-- Hidden file input for import -->
              <input type="file" id="import-file-input" accept=".csv" style="display: none" />
            </div>

            <div class="data-mgmt-section">
              <h3>Delete Local Data</h3>
              <button id="delete-all-btn" class="btn btn-delete-all">üóë Delete All Local Data</button>
              <p class="mgmt-note">‚ö†Ô∏è Permanently deletes <strong>all</strong> locally stored time entries. This cannot be undone.</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Edit Entry Modal -->
  <div id="editEntryModal" class="modal" style="display: none">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚úèÔ∏è Edit Entry</h3>
        <button onclick="closeEditModal()" class="modal-close" title="Close">‚úï</button>
      </div>
      <div class="form-group">
        <label for="editClockIn">Clock In:</label>
        <input type="datetime-local" id="editClockIn" class="auth-input" step="1" />
      </div>
      <div class="form-group">
        <label for="editClockOut">Clock Out <span class="auth-note">(leave empty if in progress)</span>:</label>
        <input type="datetime-local" id="editClockOut" class="auth-input" step="1" />
      </div>
      <div class="form-group">
        <label for="editNotes">Notes:</label>
        <textarea id="editNotes" class="auth-input edit-textarea" rows="3" placeholder="Optional notes‚Ä¶"></textarea>
      </div>
      <div id="editError" class="auth-error" style="display: none"></div>
      <div class="auth-actions">
        <button id="editSaveBtn" onclick="saveEditEntry()" class="btn-primary">Save</button>
        <button onclick="closeEditModal()" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Multi-select action banner (data viewer) -->
  <div id="dv-selection-banner" class="dv-selection-banner" style="display:none">
    <span id="dv-selection-count" class="dv-selection-count"></span>
    <div class="dv-selection-actions">
      <button id="dv-delete-selected-btn" class="btn-selection-delete">üóë Delete Selected</button>
      <button id="dv-deselect-all-btn" class="btn-selection-clear">‚úï Deselect All</button>
    </div>
  </div>

  <!-- Application Scripts (load order matters) -->
  <script src="js/common.js"></script>
  <script src="js/time-entries.js"></script>
  <script src="js/data-viewer.js"></script>
  <script src="js/app.js"></script>
  <!-- Firebase SDK (only active when firebase-config.js has a non-empty apiKey) -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/cloud-sync.js"></script>
</body>
</html>
